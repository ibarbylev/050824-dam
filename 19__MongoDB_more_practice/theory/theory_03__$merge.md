Стадия (команда) `$merge` позволяет добавить поля, созданные на предыдущих этапах (стадиях) в указанную коллекцию (чаще всего - в текущую)


```
db.collection.aggregate(
  [
    {
      $addFields: {
        new_field: 1000   // добавление нового поля
      }
    },
    
    {  // закрепление результата в БД
      $merge: {
        into: "collection", // Имя текущей коллекции
        whenMatched: "merge", // Объединяем данные при совпадении
        whenNotMatched: "insert" // Добавляем документ, если он отсутствует (опционально)
      }
    }
  ]
);
```